name: Build-test

on: [push]

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: Dep install
        run: |
          sudo apt-get update
          sudo apt install gcc-multilib
          git clone https://github.com/alliedmodders/sourcemod --recursive -b 1.10-dev
          git clone https://github.com/alliedmodders/metamod-source -b 1.10-dev
          git clone https://github.com/alliedmodders/hl2sdk -b csgo hl2sdk-csgo
          git clone -b 2.1-distutils https://github.com/alliedmodders/ambuild
          cd ambuild
          sudo python3 setup.py install
          cd ..
      - name: Build
        run: |
          EXT_DIR=${pwd}
          mkdir build
          cd build
          python3 ${EXT_DIR}/configure.py --enable-optimize --mms-path "${EXT_DIR}/metamod-source" --sm-path "${EXT_DIR}/sourcemod" --hl2sdk-root "${EXT_DIR}" --sdk csgo
          ambuild